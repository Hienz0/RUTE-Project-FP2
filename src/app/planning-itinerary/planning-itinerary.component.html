<app-user-navbar></app-user-navbar>
<div class="container my-5">
    <h1 class="text-center mb-4">Plan Your Itinerary</h1>
  
    <!-- Vacation Date Form -->
<!-- Vacation Date Form -->
<form #itineraryForm="ngForm" (ngSubmit)="onSubmit()" class="mb-5">
    <div class="row g-3">
      <div class="col-lg-6 col-md-12">
        <label for="vacationStartDate" class="form-label">Vacation Start Date</label>
        <input
          type="date"
          id="vacationStartDate"
          class="form-control"
          [(ngModel)]="vacationStartDate"
          name="vacationStartDate"
          (ngModelChange)="saveVacationDate()"
          required
        />
      </div>
      <div class="col-lg-6 col-md-12">
        <label for="vacationEndDate" class="form-label">Vacation End Date</label>
        <input
          type="date"
          id="vacationEndDate"
          class="form-control"
          [(ngModel)]="vacationEndDate"
          name="vacationEndDate"
          (ngModelChange)="saveVacationDate()"
          required
        />
      </div>
    </div>
    <button type="submit" class="btn btn-primary mt-4" [disabled]="!itineraryForm.valid">
        Plan Itinerary
      </button>
  </form>
  
  
    <!-- Services Table -->
    <div *ngIf="showServiceSelection">
      <h2 class="mb-3">Select Services</h2>
      <div class="table-responsive">
        <table class="table table-bordered">
          <thead>
            <tr>
              <th>Service Type</th>
              <th>Service Name</th>
              <th>Date(s) and Time</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let service of availableServices">
              <td>{{ service.serviceType }}</td>
              <td>{{ service.serviceName }}</td>
              <td>
                <!-- Date and Time input handling for each service type -->
                <ng-container *ngIf="service.serviceType === 'Accommodation' || service.serviceType === 'Vehicle'">
                  <!-- Date range and time for Accommodation and Vehicle -->
                  <div class="d-flex flex-column">
                    <div class="d-flex mb-2">
                      <input
                        type="date"
                        class="form-control me-2"
                        [(ngModel)]="service.startDate"
                        name="startDate-{{ service.serviceType }}"
                        [min]="vacationStartDate"
                        [max]="vacationEndDate"
                        (ngModelChange)="saveServiceChange(service)"
                        placeholder="Start Date"
                      />
                      <input
                        type="time"
                        class="form-control"
                        [(ngModel)]="service.startTime"
                        name="startTime-{{ service.serviceType }}"
                        (ngModelChange)="saveServiceChange(service)"
                      />
                    </div>
                    <div class="d-flex">
                      <input
                        type="date"
                        class="form-control me-2"
                        [(ngModel)]="service.endDate"
                        name="endDate-{{ service.serviceType }}"
                        [min]="service.startDate"
                        [max]="vacationEndDate"
                        (ngModelChange)="saveServiceChange(service)"
                        placeholder="End Date"
                      />
                      <input
                        type="time"
                        class="form-control"
                        [(ngModel)]="service.endTime"
                        name="endTime-{{ service.serviceType }}"
                        (ngModelChange)="saveServiceChange(service)"
                      />
                    </div>
                  </div>
                </ng-container>
                <ng-container *ngIf="service.serviceType === 'Tour' || service.serviceType === 'Restaurant'">
                  <!-- Single date and time for Tour and Restaurant -->
                  <div class="d-flex">
                    <input
                      type="date"
                      class="form-control me-2"
                      [(ngModel)]="service.singleDate"
                      name="singleDate-{{ service.serviceType }}"
                      [min]="vacationStartDate"
                      [max]="vacationEndDate"
                      (ngModelChange)="saveServiceChange(service)"
                      placeholder="Select Date"
                    />
                    <input
                      type="time"
                      class="form-control"
                      [(ngModel)]="service.singleTime"
                      name="singleTime-{{ service.serviceType }}"
                      (ngModelChange)="saveServiceChange(service)"
                    />
                  </div>
                </ng-container>
              </td>
              
              <td>
                <div class="d-flex justify-content-between">
                  <button class="btn btn-success me-2" (click)="addService(service)">
                    Add to Itinerary
                  </button>
                  <button class="btn btn-info" (click)="chooseService(service)">
                    Choose
                  </button>
                  <button class="btn btn-primary" (click)="viewItinerary(service)">
                    View Itinerary
                  </button>
                  
                </div>
              </td>
              
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  
    <!-- Selected Services Summary -->
    <div *ngIf="selectedServices.length > 0" class="mt-5">
      <h2 class="mb-3">Selected Services</h2>
      <ul class="list-group">
        <li *ngFor="let service of selectedServices" class="list-group-item">
          {{ service.serviceType }} - {{ service.serviceName }}
          <span *ngIf="service.startDate && service.endDate">
            ({{ service.startDate }} {{ service.startTime }} to {{ service.endDate }} {{ service.endTime }})
          </span>
          <span *ngIf="service.singleDate">
            ({{ service.singleDate }} {{ service.singleTime }})
          </span>
          <button class="btn btn-primary btn-sm me-2 float-end" (click)="viewItinerary(service)">
            View Itinerary
          </button>
          <button class="btn btn-danger btn-sm float-end" (click)="removeService(service)">
            Remove
          </button>
        </li>
      </ul>
        <!-- Display the total amount -->
  <div class="mt-3 text-end">
    <h4>Total Amount: {{ totalAmount | currency }}</h4>
  </div>
    </div>

    <div class="text-end mt-4">
      <button class="btn btn-success" (click)="confirmItinerary()">
        Confirm Itinerary
      </button>
    </div>
    


    <!-- Booking Details Modal -->
<div class="modal fade" id="bookingModal" tabindex="-1" aria-labelledby="bookingModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="bookingModalLabel">Booking Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <!-- Booking details content will be dynamically injected here -->
        <div *ngIf="bookingDetails">
          <div *ngIf="bookingDetails.serviceType === 'Accommodation'">
            <h5>{{ bookingDetails.accommodationName }}</h5>
            <p>Guest Name: {{ bookingDetails.guestName }}</p>
            <p>Accommodation Type: {{ bookingDetails.accommodationType }}</p>
            <p>Number of Guests: {{ bookingDetails.numberOfGuests }}</p>
            <p>Check-In Date: {{ bookingDetails.checkInDate | date }}</p>
            <p>Check-Out Date: {{ bookingDetails.checkOutDate | date }}</p>
            <p>Special Request: {{ bookingDetails.specialRequest }}</p>
            <p>Status: {{ bookingDetails.bookingStatus }}</p>
          </div>
          
          <div *ngIf="bookingDetails.serviceType === 'Tour'">
            <h5>{{ bookingDetails.tourName }}</h5>
            <p>Customer Name: {{ bookingDetails.customerName }}</p>
            <p>Tour Guide: {{ bookingDetails.tourguideType }}</p>
            <p>Tour Date: {{ bookingDetails.tourDate | date }}</p>
            <p>Pickup Location: {{ bookingDetails.pickupLocation }}</p>
            <p>Number of Participants: {{ bookingDetails.numberOfParticipants }}</p>
            <p>Status: {{ bookingDetails.bookingStatus }}</p>
          </div>
          
          <div *ngIf="bookingDetails.serviceType === 'Vehicle'">
            <h5>{{ bookingDetails.productName }}</h5>
            <p>Customer Name: {{ bookingDetails.customerName }}</p>
            <p>Pickup Location: {{ bookingDetails.vehiclePickupLocation }}</p>
            <p>Dropoff Location: {{ bookingDetails.vehicleDropoffLocation }}</p>
            <p>Rental Duration: {{ bookingDetails.rentalDuration }} hours</p>
            <p>Status: {{ bookingDetails.bookingStatus }}</p>
          </div>

          <div *ngIf="bookingDetails.serviceType === 'Restaurant'">
            <h5>{{ bookingDetails.productName }}</h5>
            <p>Status: {{ bookingDetails.bookingStatus }}</p>
            <p>Booking Date: {{ bookingDetails.bookingDate | date }}</p>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeModal()">Close</button>
      </div>
    </div>
  </div>
</div>

  </div>

  
  